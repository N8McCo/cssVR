<!DOCTYPE html>
<html lang="en">
<head>
  <title>css/vr test</title>
  <meta charset="utf-8">
  <script src="js/vrUtils.js"></script>
  <script src="js/vrScene.js"></script>
  <script type="text/javascript">

  function onkey(event) {
    switch (String.fromCharCode(event.charCode)) {
    case 'f':
      cssContainer.mozRequestFullScreen({ vrDisplay: vrHMD });
      break;
    case 'z':
      vrSensor.zeroSensor();
      break;
    }
  }

  function init() {
    var vrScene = new VRScene(document.querySelector('#container'));
  }

window.addEventListener("load", init, false);
window.addEventListener("keypress", onkey, true);

  </script>
</head>

<body>
  <style type="text/css">
/* keeping style block in body to make it easier to see the relationship between elements */

/* Container is nothing special; it's the element that is made full screen.
 * When non-fullscreen, you can add transforms to this element to make the scene
 * make sense in 2D (instead of being centered around the top left).  That transform
 * will cascade down to children when fullscreen though, so make sure to remove it when
 * entering fullscreen.  There's a -moz-full-screen selector that's useful for this.
 */
#container {
}

#container:not(:-moz-full-screen) {
  /* this is just to move the scene to the visible area when not in fullscreen VR */
  transform: translate(300px, 300px) rotateX(180deg);
  perspective: 1000px;
}


/* All threed-class elements have preserve-3d; preserve-3d is NOT inherited.  (There's an open
 * discussion on w3-style about adding a new transform-style that is like preserve-3d but is
 * inherited.)
 *
 * position: absolute; and 0,0 is also set because we'll position these elements fully using
 * 3D transforms.  Their CSS position is irrelevant for us.  Without this, their CSS position
 * will come into play as well as their transform.
 *
 * When in fullscreen VR, the 0,0,0 position is at the center of the viewport and not the top
 * left.
 *
 * We don't modify the original transform-origin here (50% 50% 0), because that can be useful
 * for moving elements around by their center point.  But it could also be set to 0,0,0 to
 * make it completely clear exactly where/how 3D objects are moving.
 */
.threed {
  transform-style: preserve-3d;
  position: absolute;
  top: 0; left: 0;
}

/* The camera div just serves as a way to set up a modelview transform for the entire rest of the
 * scene.  The transform that's set on it needs to be the *inverse* of where you want the camera
 * to be; that is, if you want the camera to be at (0, 0, 500), then the transform needs to be
 * set to (0, 0, -500).  The transform-origin is set here because we want to go from the origin
 */
#camera {
  transform-origin: 0 0 0;
  /* the transform itself is set programatically, since it needs to take into account the HMD orientation */
}

.pane {
  width: 150px;
  height: 50px;
  color: white;
  font-family: sans-serif;
  text-align: center;
  line-height: 50px;
  background-color: red;
  transform: rotateY(180deg);
}

#bottom {
  background-image: linear-gradient(to bottom, rgba(0, 128, 128, 1.0) 0%, rgba(128, 128, 0, 1.0) 100%);
  width: 1000px; height: 1000px;
  transform: translate(-500px, -500px) rotateX(90deg) translateZ(-200px);
  border-radius: 50%
}

@keyframes rotate {
  from {
    transform: rotateY(0deg);
  }
  to {
    transform: rotateY(360deg);
  }
}

.animate {
  animation: 15s rotate linear infinite;
}

.reverse {
  animation-direction: reverse;
}

  </style>

  <!-- this is a containing element that will be made fullscreen -->
  <div id="container" class="container">
    <!-- This is an inner element that will serve as a camera, moving its children around in the scene.
         This and all its children will have transform-style: preserve-3d set via the class, as well as
         transform-origin set to 0,0 -->
    <div class="camera threed">
      <div id="bottom" class="threed"></div>
    </div>
  </div>
  <script type="text/javascript">
  function generateStockRow(num, verticalMargin, reverse, stockValues) {
    var i;
    var panelElement;
    var horizontalMargin = 360 / num;
    var rowElement = document.createElement('div');
    var stockValue;
    rowElement.classList.add('threed');
    rowElement.classList.add('animate');
    if (reverse) {
      rowElement.classList.add('reverse');
    }
    verticalMargin += 150;

    for (i = 0; i < num; ++i) {
      stockValue = stockValues[i % stockValues.length];
      panelElement = document.createElement('div');
      panelElement.classList.add('threed');
      panelElement.classList.add('pane');
      panelElement.textContent = stockValue.symbol + ' ' + stockValue.value;
      panelElement.style.transform =
      'rotateY(' + horizontalMargin * i + 'deg) translate3d(0, 0, 500px) translate(-100px, -' + verticalMargin + 'px) rotateY(180deg)';
      rowElement.appendChild(panelElement);
    }

    return rowElement;
  }

  function generateStockPrices(num, rows, stockValues) {
    var numRow = num / rows;
    var container = document.querySelector('#camera');
    var stepMargin = 100;
    var i;
    for (i=0; i<rows; i++) {
      container.appendChild(generateStockRow(numRow, stepMargin*i, i % 2 == 0, stockValues));
    }
  }

  function getStockValues() {
   var script = document.createElement('script');
   script.setAttribute('src', "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20yahoo.finance.quote%20where%20symbol%3D'YHOO'%20or%20symbol%3D'AAPL'%20or%20symbol%3D'MSFT'%20or%20symbol%3D'TSLA'%20or%20symbol%3D'GOOG'%20or%20symbol%3D'FB'&format=json&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&callback=parseStockValues");
   document.body.appendChild(script);
  }

  function parseStockValues(data) {
   var stockValues = data.query.results.quote;
   var stockValue;
   var parsedValues = [];
   var i;
   for (i=0; i<stockValues.length;++i) {
    stockValue = stockValues[i];
    parsedValues.push({
      symbol: stockValue.Symbol,
      value: stockValue.LastTradePriceOnly
    })
   }
    generateStockPrices(100, 10, parsedValues);
  }

  fakeStockValues = [
   {
    symbol: "APPL",
    value: 10
   },
   {
    symbol: "MSFT",
    value: 20
   }];

  generateStockPrices(100, 10, fakeStockValues);

  //getStockValues();

  </script>
</body>
</html>
